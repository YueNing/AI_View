{% extends 'frontend/index_particle.html'%} 

<!--/************************************************************
 *																*
 * 						      AI VIEW							*
 *                        @naodongbanana						*
 *                        n1085633848@gmail.com					*
 *       		  Medienkunst project interface					*
 * 																*
**************************************************************-->

{% block content %}
<div class="container">
    <div class="cube cube--1">
        <div class="side side--back">
            <div class="side__inner"></div>
        </div>
        <div class="side side--left">
            <div class="side__inner"></div>
        </div>
        <div class="side side--right">
            <div class="side__inner"></div>
        </div>
        <div class="side side--top">
            <div class="side__inner"></div>
        </div>
        <div class="side side--bottom">
            <div class="side__inner"></div>
        </div>
        <div class="side side--front">
            <div class="side__inner"></div>
        </div>
    </div>
    
    <div class="cube cube--2">
        <div class="side side--back">
            <div class="side__inner"></div>
        </div>
        <div class="side side--left">
            <div class="side__inner"></div>
        </div>
        <div class="side side--right">
            <div class="side__inner"></div>
        </div>
        <div class="side side--top">
            <div class="side__inner"></div>
        </div>
        <div class="side side--bottom">
            <div class="side__inner"></div>
        </div>
        <div class="side side--front">
            <div class="side__inner"></div>
        </div>
    </div>
    
    <div class="cube cube--3">
        <div class="side side--back">
            <div class="side__inner"></div>
        </div>
        <div class="side side--left">
            <div class="side__inner"></div>
        </div>
        <div class="side side--right">
            <div class="side__inner"></div>
        </div>
        <div class="side side--top">
            <div class="side__inner"></div>
        </div>
        <div class="side side--bottom">
            <div class="side__inner"></div>
        </div>
        <div class="side side--front">
            <div class="side__inner"></div>
        </div>
    </div>
</div>
<div id='buttons'></div>

<!-- <button id='drama' type="button" class="btn btn-outline-info btn-lg">Drama</button> -->
<button id='introduction_button' type="button" class="btn btn-danger btn-lg"><span>Select a genre</span></button>

<script type="text/javascript">
    $(document).ready(function (){
        var data = {{ context|safe }};
        $.each(data['genres'], function(index, item){
            console.log(index);
            console.log(item);
            if(index%2==0){
                var r = Math.floor((Math.random() * 30) + 60);
                var t = Math.floor((Math.random() * 20) + 25*(index+1)%80);
                var item_var = $("<button id="+item+" type='button' class='btn btn-outline-info btn-lg'>"+item+"</button>");
                item_var.css({"position": "absolute", "top": t+"%", "right": r+"%"});
                $("#buttons").append(item_var);
            }
            else{
                var l = Math.floor((Math.random() * 30) + 60);
                var t = Math.floor((Math.random() * 20) + 20*(index+1)%80);
                var item_var = $("<button id="+item+" type='button' class='btn btn-outline-info btn-lg'>"+item+"</button>");
                item_var.css({"position": "absolute", "top": t+"%", "left": l+"%"});
                $("#buttons").append(item_var);
            };

        });
        $("#buttons").fadeOut(500);
        $("#buttons").fadeIn(1000);
        $.each(data['genres'], function(index, item){
            $("#"+item).click(function(){
                $.ajax({
                    url: "/frontend/genres",
                    data:{'genre':item},
                    type:'get',
                    cache:false,
                    dataType:'json',
                    success:function(data){
                        // alert(data['themes']);
                        if(data['themes']){
                            // var themes = data['themes'];
                            $('#introduction_button span').text('Select a theme');
                            $('#buttons').empty();
                            $.each(data['themes'], function(index, value){
                                if(index%2==0){
                                    var r = Math.floor((Math.random() * 30) + 60);
                                    var t = Math.floor((Math.random() * 20) + 25*(index+1)%80);
                                    var item_var = $("<button id="+value+" type='button' class='btn btn-outline-info btn-lg'>"+value+"</button>");
                                    item_var.css({"position": "absolute", "top": t+"%", "right": r+"%"});
                                    $("#buttons").append(item_var);
                                }
                                else{
                                    var l = Math.floor((Math.random() * 30) + 60);
                                    var t = Math.floor((Math.random() * 20) + 20*(index+1)%80);
                                    var item_var = $("<button id="+value+" type='button' class='btn btn-outline-info btn-lg'>"+value+"</button>");
                                    item_var.css({"position": "absolute", "top": t+"%", "left": l+"%"});
                                    $("#buttons").append(item_var);
                                };
                            })
                            var IDs = [];
                            $('#buttons').find('button').each(function(){IDs.push(this.id);})
                            $.each(IDs, function(index, value){
                                $('#'+value).click(function(){
                                // alert(value);
                                $.ajax({
                                        url:'/frontend/themes',
                                        data:{'theme':value, 'genre':data['genre']},
                                        type:'get',
                                        cache:false,
                                        dataType:'json',
                                        success:function(data){
                                            if(data['plots']){
                                                $('#introduction_button span').text('Select a plot');
                                                $('#buttons').empty();
                                                $.each(data['plots'], function(index, value){
                                                    if(index%2==0){
                                                        var r = Math.floor((Math.random() * 30) + 60);
                                                        var t = Math.floor((Math.random() * 15) + 15*(index+1)%95);
                                                        var item_var = $("<button id="+index+" type='button' class='btn btn-outline-info btn-sm'>"+value+"</button>");
                                                        item_var.css({"position": "absolute", "top": t+"%", "right": r+"%"});
                                                        $("#buttons").append(item_var);
                                                    }
                                                    else{
                                                        var l = Math.floor((Math.random() * 30) + 60);
                                                        var t = Math.floor((Math.random() * 15) + 15*(index+1)%95);
                                                        var item_var = $("<button id="+index+" type='button' class='btn btn-outline-info btn-sm'>"+value+"</button>");
                                                        item_var.css({"position": "absolute", "top": t+"%", "left": l+"%"});
                                                        $("#buttons").append(item_var);
                                                    };
                                                })
                                                var IDs_plot = [];
                                                $('#buttons').find('button').each(function(){IDs_plot.push(this.id);})
                                                $.each(IDs_plot, function(index, value){
                                                    $('#'+value).click(function(){
                                                        $.ajax({
                                                            url:'/frontend/plots',
                                                            data:{'plot':value, 'genre':data['genre'], 'selected_id':data['plots_id'][index]},
                                                            type:'get',
                                                            cache:false,
                                                            dataType:'json',
                                                            success:function(data){
                                                                // TODO
                                                                alert(data['selected_plots_id']);
                                                                var time = data['time'];
                                                                var end_time = 10;
                                                                var end_plots = [];
                                                                var end_plots_id = [];
                                                                var max_selected_times =5;
                                                                var selected_times = 0;
                                                                // alert(time);
                                                                $('#introduction_button span').text('Select a plot');
                                                                $('#buttons').empty();
                                                                // alert(time);
                                                                $.each(data['plots'], function(index, value){
                                                                            if(index%2==0){
                                                                                var r = Math.floor((Math.random() * 30) + 60);
                                                                                var t = Math.floor((Math.random() * 15) + 15*(index+1)%95);
                                                                                var item_var = $("<button id="+index+" type='button' class='btn btn-outline-info btn-sm'>"+value+"</button>");
                                                                                item_var.css({"position": "absolute", "top": t+"%", "right": r+"%"});
                                                                                $("#buttons").append(item_var);
                                                                            }
                                                                            else{
                                                                                var l = Math.floor((Math.random() * 30) + 60);
                                                                                var t = Math.floor((Math.random() * 15) + 15*(index+1)%95);
                                                                                var item_var = $("<button id="+index+" type='button' class='btn btn-outline-info btn-sm'>"+value+"</button>");
                                                                                item_var.css({"position": "absolute", "top": t+"%", "left": l+"%"});
                                                                                $("#buttons").append(item_var);
                                                                            };
                                                                })
                                                                IDs_new_plot = []
                                                                $('#buttons').find('button').each(function(){IDs_new_plot.push(this.id);})
                                                                // alert(IDs_new_plot);
                                                                $.each(IDs_plot, function(index, value){
                                                                    $('#'+value).click(function(){
                                                                        // alert(value);
                                                                        $.ajax({
                                                                            url:'/frontend/plots_1',
                                                                            data:{'selected_id':data['plots_id'][index],'old_id':data['selected_plots_id'], 'genre':data['genre'],'plot':value},
                                                                            type:'get',
                                                                            cache:false,
                                                                            dataType:'json',
                                                                            success:function(data){
                                                                                alert(data['selected_plots_id']);
                                                                                alert(data['time']);
                                                                //                 end_plots_id = data['selected_plots_id']
                                                                //                 time = data['time'];
                                                                //                 $('#introduction_button span').text('Select a plot');
                                                                //                 $('#buttons').empty();
                                                                //                 $.each(data['plots'], function(index, value){
                                                                //                     if(index%2==0){
                                                                //                         var r = Math.floor((Math.random() * 30) + 60);
                                                                //                         var t = Math.floor((Math.random() * 15) + 15*(index+1)%95);
                                                                //                         var item_var = $("<button id="+index+" type='button' class='btn btn-outline-info btn-sm'>"+value+"</button>");
                                                                //                         item_var.css({"position": "absolute", "top": t+"%", "right": r+"%"});
                                                                //                         $("#buttons").append(item_var);
                                                                //                     }
                                                                //                     else{
                                                                //                         var l = Math.floor((Math.random() * 30) + 60);
                                                                //                         var t = Math.floor((Math.random() * 15) + 15*(index+1)%95);
                                                                //                         var item_var = $("<button id="+index+" type='button' class='btn btn-outline-info btn-sm'>"+value+"</button>");
                                                                //                         item_var.css({"position": "absolute", "top": t+"%", "left": l+"%"});
                                                                //                         $("#buttons").append(item_var);
                                                                //                     };
                                                                //                 })

                                                                            },
                                                                            error:function(){console.log('error')}
                                                                        })
                                                                    })
                                                                })
                                                                // TODO
                                                                $.ajax({
                                                                    url:'/frontend/render',
                                                                    data:{'plots_id':end_plots_id},
                                                                    type:'get',
                                                                    cache:false,
                                                                    dataType:'json',
                                                                    success:function(data){
                                                                        var render_video_url = data['render_url'];
                                                                        // alert('hello');
                                                                    },
                                                                    error:function(){
                                                                        console.log('error can not get the video url');
                                                                    }
                                                                })
                                                            },
                                                            error:function(){
                                                                console.log('error plot send');
                                                            }
                                                        })
                                                    })
                                                })
                                            }
                                        },
                                        error:function(){
                                            console.log('error theme send');
                                        }
                                    })
                                })
                            })
                        }else{
                            alert('restart!');
                        }
                    },
                    error:function(jqXHR, textStatus, err){
                        alert('error');
                    }
                });
            });
        });
 
        // var r = Math.floor((Math.random() * 30) + 10);
        // var t = Math.floor((Math.random() * 30) + 20);
        // var r2 = Math.floor((Math.random() * 30) + 10);
        // var t2 = Math.floor((Math.random() * 30) + 50); 
        // var l = Math.floor((Math.random() * 30) + 60);
        // var b = Math.floor((Math.random() * 80) + 0);

        // var drama = $("<button id='drama' type='button' class='btn btn-outline-info btn-lg'> Drama </button>");
        // var comedy = $("<button id='comedy' type='button' class='btn btn-outline-info btn-lg'>Comedy</button>");
        // var Action = $("<button id='Action' type='button' class='btn btn-outline-info btn-lg'>Action</button>");
        // drama.css({"position": "absolute", "bottom": b+"%", "left": l+"%"});
        // comedy.css({"position": "absolute", "top": t+"%", "left": r+"%"});
        // Action.css({"position": "absolute", "top": t2+"%", "left": r2+"%"});
        // $("#buttons").append(drama);
        // $("#buttons").append(comedy);
        // $("#buttons").append(Action);

        // $("#Action").fadeOut();
        // $("#drama").fadeOut();
        // $("#comedy").fadeOut();
        // $("#Action").fadeIn(1000);
        // $("#drama").fadeIn(1000);
        // $("#comedy").fadeIn(1000);
    });
</script>

{% endblock %}
